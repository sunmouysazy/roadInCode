<!DOCTYPE html>
<html>

<head>

  <meta charset="utf-8"/>
  <title>用户信息页面</title>
  <script type="text/javascript" src="http://code.jquery.com/jquery-latest.js"></script>

</head>

<body>

<form id="form-user" action="userdata.html" method="get">
  用户id:
  <input id="id" name="id" type="text" readonly>*不可修改*<br>
  用户名:
  <input id="username" name="username" type="text"><br>
  密码:&nbsp;&nbsp;&nbsp;&nbsp;
  <input id="password" name="password" type="text"><br>
  角色权限:
  <input id="roleId" name="roleId" type="text"><br>
  <input id="btn-update" type="button" value="确认修改">
</form>


<script type="text/javascript">
  /*页面加载完成后开始执行*/
  $(document).ready(function() {
    var id = getQueryVariable('id');
    getUser(id);
  });

  function getQueryVariable(variable) {
    var query = window.location.search.substring(1);
    var vars = query.split('&');
    for (var i = 0; i < vars.length; i++) {
      var pair = vars[i].split('=');
      if (pair[0] == variable) {return pair[1];}
    }
    return (false);
  }

  $('#btn-update').click(function() {
    var url = '../user/update/user';
    var data = $('#form-user').serialize();
    $.ajax({
      'url': url,
      'data': data,
      'type': 'GET',
      'dataType': 'json',
      'success': function(json) {
        if (json.state == 200) {
          alert('修改成功！');
          console.log('用户列表数据：' + data);
          document.location.reload();
        } else {
          alert('修改失败！' + json.msg);
          console.log('用户列表数据：' + data);
        }
      },
      'error': function(xhr) {
        console.log('响应码：' + xhr.state);
        alert('您的登录信息已过期，请重新登录！');
        location.href = 'login.html';
      },
    });
  });

  function getUser(id) {
    var url = '../user/get';
    var data = {'id': id};
    $.ajax({
      'url': url,
      'data': data,
      'type': 'GET',
      'dataType': 'json',
      'success': function(json) {
        var user = json.data;
        $('#id').val(user.id);
        $('#username').val(user.username);
        $('#password').val(user.password);
        $('#roleId').val(user.roleId);
      },
      'error': function(xhr) {
        console.log('响应码：' + xhr.state);
        alert('您的登录信息已过期，请重新登录！');
        location.href = 'login.html';
      },
    });
  }


</script>
</body>

</html>