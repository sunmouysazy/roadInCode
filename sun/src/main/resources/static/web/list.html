<!DOCTYPE html>
<html>

<head>

  <meta charset="utf-8"/>
  <title>用户管理页面</title>
  <script type="text/javascript" src="http://code.jquery.com/jquery-latest.js"></script>

</head>

<body>


<table id="list-table" border="1px" bordercolor="red" cellspacing="5px" cellpadding="20px">
  <caption>用户列表</caption>
  <thead>
  <tr>
    <th>id</th>
    <th>用户名</th>
    <th>密码</th>
    <th>身份</th>
    <th colspan="3">操作</th>
  </tr>
  </thead>

  <tbody id="user-list">
  <tr>
    <td>1</td>
    <td>测试账号</td>
    <td>测试密码</td>
    <td><a href="#">修改</a></td>
    <td><a href="#">删除</a></td>
  </tr>
  </tbody>
</table>
<input id="page" name="page" type='text' placeholder="根据页数进行查询" onkeyup="this.value=this.value.replace(/[^0-9-]+/,'');"/>
<a href="javascript:userList($('#page').val());"><input type="button" value="跳转"></a>
<input id="find-like" name="find-like" type="text" placeholder="根据用户名进行查询">
<a href="javascript:findLike($('#find-like').val());"><input id="btn-select" type="button" value="查询"></a>
</div>
</div>

</div>


<script type="text/javascript">
  /*页面加载完成后开始执行*/
  $(document).ready(function() {
    userList();
  });

  // 首次加载
  function userList(page) {
    var url = '../user/find/page';
    var data = {'page': page};
    console.log('page:' + page + ',data:' + data);
    $.ajax({
      'url': url,
      'data': data,
      'type': 'POST',
      'dataType': 'json',
      'success': function(json) {
        if (json.state != 200) {
          alert('' + json.msg);
        } else {
          // 清除原有列表
          $('#user-list').empty();
          // 从返回结果中获取数据
          var list = json.data;
          // 遍历收货地址数据
          console.log('用户列表数据：');
          for (var i = 0; i < list.length; i++) {
            console.log('id=' + list[i].id + ', username=' + list[i].username + ', password=' + list[i].password + ', role_id=' + list[i].roleName);
            // 定义HTML代码的模版
            var html = '<tr>'
                + '<td>' + list[i].id + '</td>'
                + '<td>' + list[i].username + '</td>'
                + '<td>' + list[i].password + '</td>'
                + '<td>' + list[i].roleName + '</td>'
                + '<td><a  href="http://localhost:8080/web/userdata.html?id=' + list[i].id + '">修改</a></td>'
                + '<td><a  href="javascript:deleteById(' + list[i].id + ')">删除</a></td>'
                + '</tr>';

            // 将HTML代码添加到表格中
            $('#user-list').append(html);
          }
        }
      },
    });
  }

  function deleteById(id) {
    var url = '../user/delete';
    var data = {'id': id};
    $.ajax({
      'url': url,
      'data': data,
      'type': 'GET',
      'dataType': 'json',
      'success': function(json) {
        if (json.state == 200) {
          alert('删除成功！');
          userList();
        } else {
          alert('删除失败！' + json.msg);
        }
      },
      'error': function(xhr) {
        console.log('响应码：' + xhr.state);
        alert('您的登录信息已过期，请重新登录！');
        location.href = 'login.html';
      },
    });
  }

  function findLike(username) {
    var url = '../user/find/like';
    var data = {'username': username};
    $.ajax({
      'url': url,
      'data': data,
      'type': 'GET',
      'dataType': 'json',
      'success': function(json) {
        if (json.state == 200) {
          alert('查询成功！');
          // 清除原有列表
          $('#user-list').empty();
          // 从返回结果中获取数据
          var list = json.data;
          // 遍历收货地址数据
          console.log('用户列表数据：' + list);
          for (var i = 0; i < list.length; i++) {
            console.log('id=' + list[i].id + ', username=' + list[i].username + ', password=' + list[i].password + ', role_id=' + list[i].roleId);
            // 定义HTML代码的模版
            var html = '<tr>'
                + '<td>' + list[i].id + '</td>'
                + '<td>' + list[i].username + '</td>'
                + '<td>' + list[i].password + '</td>'
                + '<td>' + list[i].roleId + '</td>'
                + '<td><a  href="http://localhost:8080/web/userdata.html?id=' + list[i].id + '">修改</a></td>'
                + '<td><a  href="javascript:deleteById(' + list[i].id + ')">删除</a></td>'
                + '</tr>';
            // 将HTML代码添加到表格中
            $('#user-list').append(html);
          }
        } else {
          alert('查询失败！' + json.msg);
        }
      },
      'error': function(xhr) {
        console.log('响应码：' + xhr.state);
        alert('您的登录信息已过期，请重新登录！');
        location.href = 'login.html';
      },
    });
  }
</script>
</body>

</html>