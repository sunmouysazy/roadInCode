<!DOCTYPE html>
<html>

<head>

  <meta charset="utf-8"/>
  <title>菜单信息页面</title>
  <script type="text/javascript" src="http://code.jquery.com/jquery-latest.js"></script>

</head>

<body>

<form id="form-user" action="menudata.html" method="get">
  菜单id:
  <input id="id" name="id" type="text" readonly>*不可修改*<br>
  菜单名:
  <input id="text" name="text" type="text"><br>
  菜单父级id:&nbsp;&nbsp;&nbsp;&nbsp;
  <input id="pid" name="pid" type="text" readonly><br>
  <input id="btn-update" type="button" value="确认修改">
</form>


<script type="text/javascript">
  /*页面加载完成后开始执行*/
  $(document).ready(function() {
    var id = getQueryVariable('id');
    getMenu(id);
  });

  // 获取url中对应属性名的值
  function getQueryVariable(variable) {
    var query = window.location.search.substring(1);
    var vars = query.split('&');
    for (var i = 0; i < vars.length; i++) {
      var pair = vars[i].split('=');
      if (pair[0] == variable) {return pair[1];}
    }
    return (false);
  }

  $('#btn-update').click(function() {
    var url = '../user/update/menu/name';
    var data = $('#form-user').serialize();
    $.ajax({
      'url': url,
      'data': data,
      'type': 'GET',
      'dataType': 'json',
      'success': function(json) {
        if (json.state == 200) {
          alert('修改成功！');
          document.location.reload();
        } else {
          alert('修改失败！菜单名不能为空！');
          console.log('用户列表数据：' + data);
        }
      },
      'error': function(xhr) {
        console.log('响应码：' + xhr.state);
        alert('您的登录信息已过期，请重新登录！');
        location.href = 'login.html';
      },
    });
  });

  function getMenu(id) {
    var url = '../user/get/menu';
    var data = {'id': id};
    $.ajax({
      'url': url,
      'data': data,
      'type': 'GET',
      'dataType': 'json',
      'success': function(json) {
        var menu = json.data;
        $('#id').val(menu.id);
        $('#text').val(menu.text);
        $('#pid').val(menu.pid);
      },
      'error': function(xhr) {
        console.log('响应码：' + xhr.state);
        alert('您的登录信息已过期，请重新登录！');
        location.href = 'login.html';
      },
    });
  }


</script>
</body>

</html>